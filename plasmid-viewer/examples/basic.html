<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlasmidViewer ç¤ºä¾‹</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        #plasmid-viewer {
            margin: 20px auto;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            background: #1976d2;
            color: white;
            transition: background 0.2s;
        }
        button:hover {
            background: #1565c0;
        }
        button.secondary {
            background: #757575;
        }
        button.secondary:hover {
            background: #616161;
        }
        .info-panel {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 4px;
            min-height: 100px;
        }
        .info-panel h3 {
            margin-top: 0;
            color: #1976d2;
        }
        .feature-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .feature-item {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .feature-item:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <h1>ğŸ§¬ PlasmidViewer äº¤äº’å¼è´¨ç²’å›¾è°±</h1>
    
    <div class="container">
        <div class="controls">
            <button onclick="viewer.zoomIn()">æ”¾å¤§</button>
            <button onclick="viewer.zoomOut()">ç¼©å°</button>
            <button onclick="viewer.resetZoom()" class="secondary">é‡ç½®</button>
            <button onclick="loadSampleData()" class="secondary">åŠ è½½ç¤ºä¾‹</button>
            <button onclick="clearInfo()" class="secondary">æ¸…ç©ºä¿¡æ¯</button>
        </div>
        
        <div id="plasmid-viewer"></div>
        
        <div class="info-panel" id="info-panel">
            <h3>ğŸ‘† ç‚¹å‡»å›¾è°±ä¸­çš„ç‰¹å¾æŸ¥çœ‹è¯¦æƒ…</h3>
            <p>æ“ä½œè¯´æ˜ï¼š</p>
            <ul>
                <li>ğŸ–±ï¸ æ»šè½®ç¼©æ”¾</li>
                <li>âœ‹ æ‹–æ‹½ç§»åŠ¨</li>
                <li>ğŸ‘† ç‚¹å‡»æŸ¥çœ‹ç‰¹å¾è¯¦æƒ…</li>
            </ul>
        </div>
    </div>

    <!-- å¼•å…¥åº“ -->
    <script src="src/GenBankParser.js"></script>
    <script src="src/PlasmidViewer.js"></script>
    
    <script>
        // åˆ›å»ºæŸ¥çœ‹å™¨
        const viewer = new PlasmidViewer({
            container: '#plasmid-viewer',
            width: 800,
            height: 600,
            showLabels: true,
            showArrows: true,
            enableZoom: true,
            enableDrag: true,
            enableHover: true
        });

        // ç¤ºä¾‹è´¨ç²’æ•°æ®
        const samplePlasmid = {
            name: 'pLKO-TIA1-shRNA',
            length: 5000,
            features: [
                { name: 'AmpR', type: 'CDS', start: 100, end: 900, strand: '+', description: 'æ°¨è‹„é’éœ‰ç´ æŠ—æ€§' },
                { name: 'pUC ori', type: 'origin', start: 950, end: 1400, strand: '+', description: 'å¤åˆ¶èµ·å§‹ç‚¹' },
                { name: 'U6 promoter', type: 'promoter', start: 1600, end: 2000, strand: '+', description: 'U6 å¯åŠ¨å­' },
                { name: 'EGFP', type: 'fluorescent', start: 2050, end: 2750, strand: '+', description: 'å¢å¼ºå‹ç»¿è‰²è§å…‰è›‹ç™½' },
                { name: 'shRNA-TIA1', type: 'insert', start: 2800, end: 3000, strand: '+', description: 'TIA1 shRNA å¹²æ‰°ç‰‡æ®µ' },
                { name: 'hU6', type: 'promoter', start: 3050, end: 3450, strand: '+', description: 'äººç±» U6 å¯åŠ¨å­' },
                { name: 'CMV', type: 'promoter', start: 3600, end: 4200, strand: '+', description: 'CMV å¯åŠ¨å­' },
                { name: 'Puromycin', type: 'resistance', start: 4250, end: 4850, strand: '+', description: 'å˜Œå‘¤éœ‰ç´ æŠ—æ€§åŸºå› ' }
            ]
        };

        // åŠ è½½ç¤ºä¾‹æ•°æ®
        function loadSampleData() {
            viewer.load(samplePlasmid);
            showFeatures(samplePlasmid.features);
            document.getElementById('info-panel').innerHTML = `
                <h3>ğŸ“Š å·²åŠ è½½ç¤ºä¾‹è´¨ç²’: ${samplePlasmid.name}</h3>
                <p>é•¿åº¦: ${samplePlasmid.length} bp</p>
                <p>ç‰¹å¾æ•°é‡: ${samplePlasmid.features.length}</p>
                <p>ç‚¹å‡»å›¾è°±ä¸­çš„ç‰¹å¾æŸ¥çœ‹è¯¦æƒ…</p>
            `;
        }

        // æ˜¾ç¤ºç‰¹å¾åˆ—è¡¨
        function showFeatures(features) {
            const panel = document.getElementById('info-panel');
            const html = features.map(f => `
                <span class="feature-item" 
                      style="background:${f.color || '#9E9E9E'}; color: white;"
                      onmouseover="viewer.highlightFeature('${f.name}')"
                      onmouseout="viewer.clearHighlight()"
                      onclick="showFeatureDetail(${JSON.stringify(f).replace(/"/g, '&quot;')})">
                    ${f.name} (${f.type})
                </span>
            `).join('');
            
            panel.innerHTML += `<div class="feature-list" style="margin-top:10px">${html}</div>`;
        }

        // æ˜¾ç¤ºç‰¹å¾è¯¦æƒ…
        function showFeatureDetail(feature) {
            const panel = document.getElementById('info-panel');
            panel.innerHTML = `
                <h3>ğŸ”¬ ç‰¹å¾è¯¦æƒ…: ${feature.name}</h3>
                <table style="width:100%; text-align:left;">
                    <tr><td><strong>ç±»å‹:</strong></td><td>${feature.displayType || feature.type}</td></tr>
                    <tr><td><strong>ä½ç½®:</strong></td><td>${feature.start} - ${feature.end} bp</td></tr>
                    <tr><td><strong>é•¿åº¦:</strong></td><td>${feature.length || feature.end - feature.start + 1} bp</td></tr>
                    <tr><td><strong>é“¾å‘:</strong></td><td>${feature.strand === '+' ? 'æ­£å‘ (+)' : 'åå‘ (-)'}</td></tr>
                    <tr><td><strong>æè¿°:</strong></td><td>${feature.description || '-'}</td></tr>
                </table>
            `;
        }

        // æ¸…ç©ºä¿¡æ¯
        function clearInfo() {
            document.getElementById('info-panel').innerHTML = `
                <h3>ğŸ‘† ç‚¹å‡»å›¾è°±ä¸­çš„ç‰¹å¾æŸ¥çœ‹è¯¦æƒ…</h3>
                <p>æ“ä½œè¯´æ˜ï¼š</p>
                <ul>
                    <li>ğŸ–±ï¸ æ»šè½®ç¼©æ”¾</li>
                    <li>âœ‹ æ‹–æ‹½ç§»åŠ¨</li>
                    <li>ğŸ‘† ç‚¹å‡»æŸ¥çœ‹ç‰¹å¾è¯¦æƒ…</li>
                </ul>
            `;
        }

        // ç»‘å®šäº‹ä»¶
        viewer.on('featureClick', (feature) => {
            showFeatureDetail(feature);
            console.log('ç‚¹å‡»ç‰¹å¾:', feature);
        });

        viewer.on('featureHover', (feature) => {
            console.log('æ‚¬åœç‰¹å¾:', feature.name);
        });

        viewer.on('plasmidLoad', (plasmid) => {
            console.log('å·²åŠ è½½è´¨ç²’:', plasmid.name);
        });

        // é¡µé¢åŠ è½½åè‡ªåŠ¨åŠ è½½ç¤ºä¾‹
        loadSampleData();
    </script>
</body>
</html>
