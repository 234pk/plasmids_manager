<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlasmidViewer æµ‹è¯• - çœŸå®è´¨ç²’</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(90deg, #1976d2, #1565c0);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h2 { margin: 0; font-size: 20px; }
        .header-info { font-size: 12px; opacity: 0.9; }
        #plasmid-viewer {
            width: 100%;
            height: 500px;
            background: #fafafa;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #plasmid-viewer svg {
            display: block;
        }
        .controls {
            display: flex;
            gap: 8px;
            padding: 15px;
            background: #f5f5f5;
            border-bottom: 1px solid #eee;
            flex-wrap: wrap;
        }
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        .btn-primary { background: #1976d2; color: white; }
        .btn-primary:hover { background: #1565c0; }
        .btn-secondary { background: #757575; color: white; }
        .btn-secondary:hover { background: #616161; }
        .btn-success { background: #4caf50; color: white; }
        .btn-success:hover { background: #388e3c; }
        .info-panel {
            padding: 20px;
            min-height: 120px;
            background: white;
        }
        .info-panel h3 {
            color: #1976d2;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .feature-card {
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .feature-card .name { font-weight: bold; font-size: 13px; color: white; }
        .feature-card .type { font-size: 11px; color: rgba(255,255,255,0.9); margin-top: 4px; }
        .feature-card .pos { font-size: 10px; color: rgba(255,255,255,0.8); margin-top: 4px; }
        .detail-panel {
            display: none;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 10px;
        }
        .detail-panel.active { display: block; }
        .detail-row {
            display: flex;
            padding: 6px 0;
            border-bottom: 1px solid #eee;
        }
        .detail-row:last-child { border-bottom: none; }
        .detail-label { width: 100px; color: #666; font-size: 12px; }
        .detail-value { flex: 1; font-size: 12px; color: #333; }
        .loading {
            color: #999;
            font-size: 14px;
        }
        .error {
            color: #f44336;
            padding: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>ğŸ§¬ PlasmidViewer - äº¤äº’å¼è´¨ç²’å›¾è°±</h1>
    
    <div class="container">
        <div class="header">
            <div>
                <h2 id="plasmid-name">åŠ è½½ä¸­...</h2>
                <div class="header-info" id="plasmid-info"></div>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn-primary" onclick="loadPlasmid('pLKO')">ğŸ“¦ pLKO-shRNA</button>
            <button class="btn-secondary" onclick="loadPlasmid('pCDH')">ğŸ“¦ pCDH-OE</button>
            <button class="btn-success" onclick="loadPlasmid('pcDNA')">ğŸ“¦ pcDNA3.1</button>
            <button class="btn-secondary" onclick="viewer.resetZoom()">ğŸ”„ é‡ç½®è§†å›¾</button>
        </div>
        
        <div id="plasmid-viewer">
            <span class="loading">æ­£åœ¨åŠ è½½è´¨ç²’å›¾è°±...</span>
        </div>
        
        <div class="info-panel">
            <h3>ğŸ“‹ ç‰¹å¾åˆ—è¡¨ (ç‚¹å‡»å›¾è°±æˆ–åˆ—è¡¨æŸ¥çœ‹è¯¦æƒ…)</h3>
            <div class="feature-grid" id="feature-grid"></div>
            <div class="detail-panel" id="detail-panel">
                <div class="detail-row">
                    <span class="detail-label">åç§°</span>
                    <span class="detail-value" id="detail-name"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">ç±»å‹</span>
                    <span class="detail-value" id="detail-type"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">ä½ç½®</span>
                    <span class="detail-value" id="detail-pos"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">é•¿åº¦</span>
                    <span class="detail-value" id="detail-len"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">é“¾å‘</span>
                    <span class="detail-value" id="detail-strand"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">æè¿°</span>
                    <span class="detail-value" id="detail-desc"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥åº“ -->
    <script src="src/GenBankParser.js"></script>
    <script src="src/PlasmidViewer.js"></script>
    
    <script>
        let viewer = null;
        let currentPlasmid = null;

        // è´¨ç²’æ•°æ®
        const plasmids = {
            'pLKO': {
                name: 'pLKO-TIA1-shRNA',
                length: 5021,
                features: [
                    { name: 'AmpR', type: 'CDS', start: 431, end: 1201, strand: '+', description: 'æ°¨è‹„é’éœ‰ç´ æŠ—æ€§åŸºå› ' },
                    { name: 'EM7', type: 'promoter', start: 1298, end: 1697, strand: '+', description: 'EM7 å¯åŠ¨å­' },
                    { name: 'U6', type: 'promoter', start: 1768, end: 2181, strand: '+', description: 'U6 å¯åŠ¨å­' },
                    { name: 'shRNA-TIA1', type: 'insert', start: 2234, end: 2314, strand: '+', description: 'TIA1 shRNA å¹²æ‰°ç‰‡æ®µ' },
                    { name: 'hPGK', type: 'promoter', start: 2400, end: 2953, strand: '+', description: 'äºº PGK å¯åŠ¨å­' },
                    { name: 'Puromycin', type: 'CDS', start: 3043, end: 3741, strand: '+', description: 'å˜Œå‘¤éœ‰ç´ æŠ—æ€§åŸºå› ' },
                    { name: 'bGH polyA', type: 'polyA_signal', start: 3878, end: 4120, strand: '+', description: 'ç‰›ç”Ÿé•¿æ¿€ç´  polyA ä¿¡å·' },
                    { name: 'EGFP', type: 'fluorescent', start: 4400, end: 4760, strand: '+', description: 'å¢å¼ºå‹ç»¿è‰²è§å…‰è›‹ç™½' },
                    { name: 'CMV', type: 'promoter', start: 4765, end: 5021, strand: '+', description: 'CMV å¯åŠ¨å­' }
                ]
            },
            'pCDH': {
                name: 'pCDH-EF1Î±-GAPDH-OE',
                length: 7243,
                features: [
                    { name: 'AmpR', type: 'CDS', start: 650, end: 1419, strand: '+', description: 'æ°¨è‹„é’éœ‰ç´ æŠ—æ€§åŸºå› ' },
                    { name: 'pUC ori', type: 'origin', start: 1500, end: 2100, strand: '+', description: 'pUC å¤åˆ¶èµ·å§‹ç‚¹' },
                    { name: 'EF1Î±', type: 'promoter', start: 2200, end: 2900, strand: '+', description: 'EF1Î± å¯åŠ¨å­' },
                    { name: 'GAPDH', type: 'CDS', start: 2950, end: 3800, strand: '+', description: 'GAPDH è¿‡è¡¨è¾¾ç‰‡æ®µ' },
                    { name: '3Ã—FLAG', type: 'CDS', start: 2900, end: 2950, strand: '+', description: '3Ã—FLAG æ ‡ç­¾' },
                    { name: 'IRES', type: 'insert', start: 3850, end: 4450, strand: '+', description: 'IRES å…ƒä»¶' },
                    { name: 'CopGFP', type: 'fluorescent', start: 4500, end: 5200, strand: '+', description: 'ç»¿è‰²è§å…‰è›‹ç™½' },
                    { name: 'NeoR', type: 'CDS', start: 5250, end: 6050, strand: '+', description: 'æ–°éœ‰ç´ æŠ—æ€§åŸºå› ' },
                    { name: 'WPRE', type: 'insert', start: 6100, end: 6500, strand: '+', description: 'WPRE å…ƒä»¶' },
                    { name: 'Î”U3', type: 'promoter', start: 6600, end: 7243, strand: '+', description: 'HIV Î”U3 å¯åŠ¨å­' }
                ]
            },
            'pcDNA': {
                name: 'pcDNA3.1-mCherry-TIA1',
                length: 5428,
                features: [
                    { name: 'AmpR', type: 'CDS', start: 267, end: 1037, strand: '+', description: 'æ°¨è‹„é’éœ‰ç´ æŠ—æ€§åŸºå› ' },
                    { name: 'pUC ori', type: 'origin', start: 1100, end: 1700, strand: '+', description: 'pUC å¤åˆ¶èµ·å§‹ç‚¹' },
                    { name: 'CMV', type: 'promoter', start: 1800, end: 2400, strand: '+', description: 'CMV å¯åŠ¨å­' },
                    { name: 'mCherry', type: 'fluorescent', start: 2450, end: 3200, strand: '+', description: 'çº¢è‰²è§å…‰è›‹ç™½' },
                    { name: 'TIA1', type: 'CDS', start: 3250, end: 4100, strand: '+', description: 'TIA1 é¶åŸºå› è¿‡è¡¨è¾¾' },
                    { name: '3Ã—HA', type: 'CDS', start: 3200, end: 3250, strand: '+', description: '3Ã—HA æ ‡ç­¾' },
                    { name: 'BGH polyA', type: 'polyA_signal', start: 4150, end: 4400, strand: '+', description: 'BGH polyA ä¿¡å·' },
                    { name: 'SV40', type: 'promoter', start: 4450, end: 4750, strand: '+', description: 'SV40 å¯åŠ¨å­' },
                    { name: 'NeoR', type: 'CDS', start: 4800, end: 5600, strand: '+', description: 'æ–°éœ‰ç´ æŠ—æ€§åŸºå› ' }
                ]
            }
        };

        function initViewer() {
            viewer = new PlasmidViewer({
                container: '#plasmid-viewer',
                width: 800,
                height: 500,
                showLabels: true,
                showArrows: true,
                enableZoom: true,
                enableDrag: true,
                enableHover: true,
                colors: {
                    CDS: '#4CAF50',
                    promoter: '#2196F3',
                    origin: '#FF9800',
                    fluorescent: '#E91E63',
                    resistance: '#9C27B0',
                    insert: '#FF5722',
                    polyA_signal: '#00BCD4',
                    primer_bind: '#607D8B',
                    other: '#9E9E9E'
                }
            });

            // ç»‘å®šäº‹ä»¶
            viewer.on('featureClick', showFeatureDetail);
            viewer.on('featureHover', (f) => {
                console.log('æ‚¬åœ:', f.name);
            });

            // åŠ è½½é»˜è®¤è´¨ç²’
            loadPlasmid('pLKO');
        }

        function loadPlasmid(key) {
            const plasmid = plasmids[key];
            if (!plasmid) return;

            currentPlasmid = plasmid;

            // æ›´æ–°æ ‡é¢˜
            document.getElementById('plasmid-name').textContent = plasmid.name;
            document.getElementById('plasmid-info').textContent = 
                `é•¿åº¦: ${plasmid.length} bp | ç‰¹å¾æ•°: ${plasmid.features.length}`;

            // åŠ è½½åˆ°æŸ¥çœ‹å™¨
            viewer.load(plasmid);

            // æ¸²æŸ“ç‰¹å¾åˆ—è¡¨
            renderFeatureGrid(plasmid.features);

            // æ¸…ç©ºè¯¦æƒ…
            document.getElementById('detail-panel').classList.remove('active');
        }

        function renderFeatureGrid(features) {
            const grid = document.getElementById('feature-grid');
            grid.innerHTML = features.map(f => `
                <div class="feature-card" 
                     style="background:${getFeatureColor(f.type)}"
                     onclick="showFeatureDetail(${JSON.stringify(f).replace(/"/g, '&quot;')})"
                     onmouseover="viewer.highlightFeature('${f.name}')"
                     onmouseout="viewer.clearHighlight()">
                    <div class="name">${f.name}</div>
                    <div class="type">${getFeatureTypeLabel(f.type)}</div>
                    <div class="pos">${f.start} - ${f.end}</div>
                </div>
            `).join('');
        }

        function showFeatureDetail(feature) {
            currentFeature = feature;
            
            document.getElementById('detail-name').textContent = feature.name;
            document.getElementById('detail-type').textContent = getFeatureTypeLabel(feature.type);
            document.getElementById('detail-pos').textContent = `${feature.start} - ${feature.end} bp`;
            document.getElementById('detail-len').textContent = `${feature.end - feature.start + 1} bp`;
            document.getElementById('detail-strand').textContent = feature.strand === '+' ? 'æ­£å‘ (+)' : 'åå‘ (-)';
            document.getElementById('detail-desc').textContent = feature.description || '-';
            
            document.getElementById('detail-panel').classList.add('active');

            // é«˜äº®
            viewer.highlightFeature(feature.name);
        }

        function getFeatureColor(type) {
            const colors = {
                CDS: '#4CAF50',
                promoter: '#2196F3',
                origin: '#FF9800',
                fluorescent: '#E91E63',
                resistance: '#9C27B0',
                insert: '#FF5722',
                polyA_signal: '#00BCD4',
                primer_bind: '#607D8B'
            };
            return colors[type] || '#9E9E9E';
        }

        function getFeatureTypeLabel(type) {
            const labels = {
                CDS: 'CDS (ç¼–ç åŒº)',
                promoter: 'å¯åŠ¨å­',
                origin: 'å¤åˆ¶èµ·ç‚¹',
                fluorescent: 'è§å…‰è›‹ç™½',
                resistance: 'æŠ—æ€§åŸºå› ',
                insert: 'æ’å…¥ç‰‡æ®µ',
                polyA_signal: 'PolyA ä¿¡å·',
                primer_bind: 'å¼•ç‰©ç»“åˆä½ç‚¹'
            };
            return labels[type] || type;
        }

        // åˆå§‹åŒ–
        window.onload = initViewer;
    </script>
</body>
</html>
