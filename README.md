# Plasmid Manager Development Log

### Settings Page Internationalization and Export Optimization (2026-02-07)
- **Full Translation of Settings Page**:
    - Fixed multiple hardcoded Chinese texts in the settings modal, achieving complete internationalization binding.
    - Covered translation for 12+ UI elements including "Default Owner", "Items per Page", "Sort Order", "Empty State Prompt", and search box placeholders.
    - Optimized the display logic of pagination controls to support grammatical differences between Chinese and English (e.g., "第 X 到 Y 条" vs. "Showing X to Y").
- **Enhanced Operation Feedback**:
    - Added Toast real-time feedback for the "Save" button on the settings page, ensuring users receive clear visual confirmation after saving configurations.
- **Data Export Optimization**:
    - Resolved the issue where "Project" and "Owner" only displayed ID numbers during CSV export.
    - Enhanced the `downloadCSV` function to automatically convert IDs to names, ensuring exported data is readable for sharing and review.
- **Involved Files**: `index.html`, `js/app.js`, `js/translations_data.js`, `js/data-service.js`.

### Smart Recognition Enhancement and macOS Build Optimization (2026-02-07)
- **"New Plasmid" Smart Recognition Enhancement**:
    - Upgraded the smart recognition UI during single plasmid creation to the **optional checkbox preview** mode, consistent with batch import.
    - Added the **manual add (+) recognition item** feature, supporting quick expansion of attributes during single creation.
    - Introduced an **automatic recognition switch**, allowing users to control whether smart parsing is triggered when entering a name.
    - Implemented state synchronization: checking a preview item automatically updates the main form fields in real-time.
- **macOS Build Compatibility Fix**:
    - Increased the icon size generated by `convert-icon.js` to `1024x1024`, resolving the minimum 512x512 icon requirement for macOS packaging.
- **Internationalization and Garbled Text Fix**:
    - Completely resolved potential garbled text issues for `gen_1611` (software open) and `gen_1612` (view sequence) buttons in some environments.
    - Ensured text rendering stability by migrating these core button texts to the `common` namespace in i18n and updating references.
    - Improved the general text lookup table in `i18n.js` to support both Chinese and English.
- **Involved Files**: `index.html`, `js/app.js`, `js/i18n.js`, `js/translations_data.js`, `convert-icon.js`.

### Batch Import UI/UX Deep Optimization and Internationalization Improvement (2026-02-07)
- **Input Interaction Upgrade**:
    - All 12 key plasmid attributes (e.g., resistance, tags, promoters) text input fields have been fully upgraded to **selectable checkbox lists**.
    - Implemented **dynamic new value addition** functionality, allowing users to directly input and expand the attribute library on the interface, with automatic deduplication logic.
    - Optimized data saving logic: only selected attribute values from the list are persisted, avoiding interference from invalid data.
- **Batch Import Enhancement**:
    - Modal width adjusted to `98vw`, significantly improving the display of long filenames on the interface, supporting automatic line wrapping.
    - Fixed `t is not defined` runtime error, ensuring the translation function is available in all logical modules.
    - Implemented **cross-validation recognition** of filenames and file content (GenBank features), greatly improving the accuracy of auto-filling.
- **Internationalization (i18n) Completeness**:
    - Removed all hardcoded Chinese guidance content from `app.js`, unifying it through the i18n translation engine.
    - Improved the Chinese-English lookup table in `translations_data.js`, fixing redundant symbols and formatting errors in some texts.
    - Explicitly set HTML script loading encoding to `UTF-8`, resolving potential title garbling issues in Windows desktop environments.
- **Engineering and Distribution**:
    - Configured GitHub Actions workflow to enable automated cross-platform build and release processes triggered by code tags.
    - Added permission management configuration (`entitlements`) for macOS to ensure file access and runtime compatibility on macOS.
- **Involved Files**: `index.html`, `js/app.js`, `js/batch-logic.js`, `js/recognition.js`, `js/translations_data.js`, `package.json`, `.github/workflows/release.yml`.

### UniProt Deep Integration: Species Filtering and Data Enhancement
- **New Capabilities**:
  - Based on Chrome extension logic, supports precise species filtering by Taxonomy ID (based on plasmid "species" field).
  - Implemented a search strategy prioritizing Reviewed (manually reviewed) entries, falling back to Unreviewed, to improve result relevance.
  - Added extraction of extended information such as Subcellular Location, RefSeq ID, and STRING ID.
- **Scope of Impact**:
  - `js/services/uniprotService.js` (core search logic refactoring, field parsing enhancement)
  - `js/app.js` (species ID mapping and transfer)
  - `index.html` (modal UI update, display extended information)

### Fixes and Optimizations (2026-02-06)
- **Fix**: Resolved `plasmid.物种.trim is not a function` runtime error, enhancing compatibility with non-string (e.g., array) species fields.
- **Optimization**: Corrected HTML validation errors in `index.html` (including missing button types, improper tag nesting, unescaped characters), improving code quality and accessibility.
- **Feature Enhancement**: Optimized the display specification for UniProt function descriptions.
  - Supports displaying multiple function descriptions as a list (originally only displayed the first one).
  - Automatically parses and links literature references (e.g., `(PubMed:123456)` converted to clickable links).
  - Added FlyBase ID extraction and display (supports clicking to jump to FlyBase report page).
  - Involved Files: `js/services/uniprotService.js`, `index.html`, `package.json`.

### Packaging, Runtime, and Path Security Optimization (2026-02-06)
- **Core Fix**: Resolved the issue where the packaged `.exe` could not be opened (silent crash).
- **Path Redirection**:
  - Redirected storage paths for databases, settings, and logs from `__dirname` (installation directory, usually read-only and permission-restricted) to `app.getPath('userData')` (user data directory).
  - Ensured the program can still perform file read/write operations normally after being packaged as ASAR.
- **Automatic Migration Mechanism**:
  - Implemented database migration logic from the installation directory to the user data directory, ensuring data is not lost after users update the version.
- **Packaging Enhancement**:
  - Introduced the `sharp` library to replace `svg2png`, resolving compatibility errors during icon conversion in Windows environments.
  - Prioritized the use of the generated `icon.png` in `main.js` to improve the success rate of window icon loading.
- **Involved Files**: `main.js`, `package.json`, `convert-icon.js`.
- **Custom Icon (v4 Design - Final Visual Enhancement)**:
  - Fourth redraw based on the user-provided reference image, achieving high visual fidelity.
  - **Visual Fidelity**: Simulated the thick blue plasmid broken ring, intertwined DNA double helix path, and the "electric spark/break" details at the top from the reference image.
  - **Packaging Compatibility Optimization (2026-02-06)**:
    - Simplified the `icon.svg` structure to address `electron-builder`'s SVG conversion errors (`ERR_ELECTRON_BUILDER_CANNOT_EXECUTE`) on Windows.
    - Removed `filter` effects and complex `tspan` nesting that caused conversion crashes, using flattened paths to achieve visual effects.
    - Optimized `package.json`'s `build` configuration, precisely limiting icon declaration to the `win` platform section to reduce build interference.
- **Integrated Application**:
  - `main.js`: Set Electron window icon to ensure the icon is displayed in the desktop taskbar and window title bar.
  - `index.html`: Added Favicon link to improve visual consistency of the application across different environments.
  - `package.json`: Updated packaging configuration to apply the new icon to the generated `.exe` installer and portable version.
- **Involved Files**: `assets/icon.svg`, `main.js`, `index.html`, `package.json`.